{
  "version": 3,
  "sources": ["../../src/notification/notification_manager.ts"],
  "sourcesContent": ["import {SamartHomeHandyBis} from \"../main\";\nimport {Events, StateChangeEvent} from \"../listener/listener\";\n\nimport {DataPack, NotificationPack} from \"../server/datapacks\";\nimport {Client} from \"../server/client\";\n\nexport class NotificationManager {\n    adapter: SamartHomeHandyBis;\n    backlog: {[deviceID: string] : string[]}= {};\n    constructor(adapter: SamartHomeHandyBis) {\n        this.adapter = adapter;\n        this.init();\n    }\n\n\n    private init() : void {\n        this.adapter.listener.on(Events.StateChange, this.onStateChange.bind(this));\n    }\n\n\n    private onStateChange(event: StateChangeEvent) : void {\n        const match : RegExpMatchArray | null = event.objectID.match(\"(hiob.\\\\d*.devices.)(.*)(.sendNotification)\");\n        if(match && match[2]) {\n            const deviceID = match[2];\n            const client = this.adapter.server?.getClient(deviceID);\n            //Check if client is connected\n            if(client?.isConnected) {\n                this.sendNotificationLocal(client, event.value);\n\n            } else {\n                //Store to backlog\n                if(this.backlog[deviceID]) {\n                    this.backlog[deviceID].push(event.value)\n                } else {\n                    this.backlog[deviceID] = [event.value];\n                }\n            }\n\n\n\n\n        }\n    }\n\n\n    private sendNotificationLocal(client: Client, notification: string) : void {\n        client.sendMSG(new NotificationPack(false, notification, new Date()).toJSON(), true);\n    }\n\n\n\n\n}\n\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,sBAAuC;AAEvC,uBAAyC;AAGlC,MAAM,oBAAoB;AAAA,EAG7B,YAAY,SAA6B;AADzC,mBAA0C,CAAC;AAEvC,SAAK,UAAU;AACf,SAAK,KAAK;AAAA,EACd;AAAA,EAGQ,OAAc;AAClB,SAAK,QAAQ,SAAS,GAAG,uBAAO,aAAa,KAAK,cAAc,KAAK,IAAI,CAAC;AAAA,EAC9E;AAAA,EAGQ,cAAc,OAAgC;AApB1D;AAqBQ,UAAM,QAAkC,MAAM,SAAS,MAAM,6CAA6C;AAC1G,QAAG,SAAS,MAAM,IAAI;AAClB,YAAM,WAAW,MAAM;AACvB,YAAM,UAAS,UAAK,QAAQ,WAAb,mBAAqB,UAAU;AAE9C,UAAG,iCAAQ,aAAa;AACpB,aAAK,sBAAsB,QAAQ,MAAM,KAAK;AAAA,MAElD,OAAO;AAEH,YAAG,KAAK,QAAQ,WAAW;AACvB,eAAK,QAAQ,UAAU,KAAK,MAAM,KAAK;AAAA,QAC3C,OAAO;AACH,eAAK,QAAQ,YAAY,CAAC,MAAM,KAAK;AAAA,QACzC;AAAA,MACJ;AAAA,IAKJ;AAAA,EACJ;AAAA,EAGQ,sBAAsB,QAAgB,cAA6B;AACvE,WAAO,QAAQ,IAAI,kCAAiB,OAAO,cAAc,IAAI,KAAK,CAAC,EAAE,OAAO,GAAG,IAAI;AAAA,EACvF;AAKJ;",
  "names": []
}
